"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6676],{3808:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var i=n(4848),o=n(8453);const s={sidebar_position:30},r="Inspecting Compilation and Compiled Code",a={id:"using-plutus-tx/inspecting",title:"Inspecting Compilation and Compiled Code",description:"On this page, you\u2019ll learn how to look into the compilation of Plutus Tx and the resulting compiled code, which you might want to do for reasons such as debugging and tuning.",source:"@site/docs/using-plutus-tx/inspecting.md",sourceDirName:"using-plutus-tx",slug:"/using-plutus-tx/inspecting",permalink:"/docs/using-plutus-tx/inspecting",draft:!1,unlisted:!1,editUrl:"https://github.com/IntersectMBO/plutus/edit/master/doc/docusaurus/docs/using-plutus-tx/inspecting.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30},sidebar:"tutorialSidebar",previous:{title:"Special Functions and Types",permalink:"/docs/using-plutus-tx/special-functions-and-types"},next:{title:"Working with scripts",permalink:"/docs/category/working-with-scripts"}},c={},l=[{value:"Inspecting the Compilation",id:"inspecting-the-compilation",level:2},{value:"Inspecting the Compiled Code",id:"inspecting-the-compiled-code",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"inspecting-compilation-and-compiled-code",children:"Inspecting Compilation and Compiled Code"}),"\n",(0,i.jsx)(t.p,{children:"On this page, you\u2019ll learn how to look into the compilation of Plutus Tx and the resulting compiled code, which you might want to do for reasons such as debugging and tuning."}),"\n",(0,i.jsx)(t.h2,{id:"inspecting-the-compilation",children:"Inspecting the Compilation"}),"\n",(0,i.jsx)(t.p,{children:"In the event of a compilation failure, a trace of compilation steps leading to the problematic GHC Core expression is printed.\nThis is comparable to the stack trace from a program encountering an uncaught exception.\nFor example, if you use an unsupported Haskell feature, causing the compilation to fail, this trace can often help you identify where it appears in the source code."}),"\n",(0,i.jsxs)(t.p,{children:["Another way of inspecting the compilation is by using the ",(0,i.jsx)(t.code,{children:"dump-compilation-trace"})," plugin flag:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-haskell",children:"{-# OPTIONS_GHC -fplugin-opt PlutusTx.Plugin:dump-compilation-trace #-}\n"})}),"\n",(0,i.jsx)(t.p,{children:"This compilation trace has two main differences from the previously mentioned trace:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"It prints every single step taken by the compiler, as the compilation proceeds, rather than just the trace leading to the failure."}),"\n",(0,i.jsx)(t.li,{children:"It can be used to show the trace whether the compilation succeeded or failed.\nThis is convenient because sometimes you might want to compare the trace of a failed compilation against the trace of a succeeded compilation to figure out where it went wrong."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In the compilation trace, to make it easier to figure out how the compilation got to a certain point, every step is annotated with an ID along with the ID of the parent step."}),"\n",(0,i.jsx)(t.h2,{id:"inspecting-the-compiled-code",children:"Inspecting the Compiled Code"}),"\n",(0,i.jsxs)(t.p,{children:["A ",(0,i.jsx)(t.code,{children:"CompiledCode"})," obtained through normal compilation includes a UPLC program along with the corresponding PIR program.\nPIR is an intermediate representation used by the Plutus Tx compiler.\nIt is much more readable than UPLC, so for tasks such as debugging and performance tuning, it is usually more helpful to inspect PIR, but there are also instances where looking into UPLC directly is necessary."]}),"\n",(0,i.jsxs)(t.p,{children:["The PIR and UPLC programs can be retrieved from the ",(0,i.jsx)(t.code,{children:"CompiledCode"})," via ",(0,i.jsx)(t.code,{children:"getPirNoAnn"})," and ",(0,i.jsx)(t.code,{children:"getPlcNoAnn"})," from ",(0,i.jsx)(t.a,{href:"https://plutus.cardano.intersectmbo.org/haddock/latest/plutus-tx/PlutusTx-Code.html",children:(0,i.jsx)(t.code,{children:"PlutusTx.Code"})}),".\nThe annotations are usually not needed, but if you do need them, use ",(0,i.jsx)(t.code,{children:"getPir"})," and ",(0,i.jsx)(t.code,{children:"getPlc"})," instead."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"plutus-core"})," library provides several ways for pretty-printing PIR and UPLC programs.\nThere are two main configuration options for pretty-printing:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Choosing between the classic syntax or a more readable syntax."}),"\n",(0,i.jsx)(t.li,{children:"Choosing whether to show uniques.\nUniques are numerical identifiers assigned to variable names; while they ensure unambiguity, they can introduce clutter."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The following table shows the functions for pretty-printing PIR and UPLC programs.\nAll these are from the ",(0,i.jsx)(t.a,{href:"https://plutus.cardano.intersectmbo.org/haddock/latest/plutus-core/PlutusCore-Pretty.html",children:(0,i.jsx)(t.code,{children:"PlutusCore.Pretty"})})," module."]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{}),(0,i.jsx)(t.th,{children:"Classic Syntax"}),(0,i.jsx)(t.th,{children:"Readable Syntax"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"No Uniques"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"prettyClassicSimple"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"prettyReadableSimple"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"With Uniques"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"prettyClassic"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"prettyReadable"})})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(6540);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);