"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5688],{5370:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>r,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var i=n(4848),s=n(8453);const a={sidebar_position:15},o="Life cycle of the auction smart contract",c={id:"auction-smart-contract/life-cycle",title:"Life cycle of the auction smart contract",description:"With the Plutus script written, Alice is now ready to start the auction smart contract.",source:"@site/docs/auction-smart-contract/life-cycle.md",sourceDirName:"auction-smart-contract",slug:"/auction-smart-contract/life-cycle",permalink:"/docs/auction-smart-contract/life-cycle",draft:!1,unlisted:!1,editUrl:"https://github.com/IntersectMBO/plutus/edit/master/doc/docusaurus/docs/auction-smart-contract/life-cycle.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"Closing the Auction",permalink:"/docs/auction-smart-contract/end-to-end/closing-the-auction"},next:{title:"Essential concepts",permalink:"/docs/category/essential-concepts"}},r={},d=[{value:"Initial UTXO",id:"initial-utxo",level:2},{value:"The first bid",id:"the-first-bid",level:2},{value:"The second bid",id:"the-second-bid",level:2},{value:"Closing the auction",id:"closing-the-auction",level:2}];function h(t){const e={code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,s.R)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"life-cycle-of-the-auction-smart-contract",children:"Life cycle of the auction smart contract"}),"\n",(0,i.jsxs)(e.p,{children:["With the Plutus script written, Alice is now ready to start the auction smart contract.\nAt the outset, Alice creates a script UTXO whose address is the hash of the Plutus script, whose value is the token to be auctioned, and whose datum is ",(0,i.jsx)(e.code,{children:"Nothing"}),".\nRecall that the datum represents the highest bid, and there's no bid yet.\nThis script UTXO also contains the script itself, so that nodes validating transactions that try to spend this script UTXO have access to the script."]}),"\n",(0,i.jsx)(e.h2,{id:"initial-utxo",children:"Initial UTXO"}),"\n",(0,i.jsx)(e.p,{children:"Alice needs to create the initial UTXO transaction with the desired UTXO as an output.\nThe token being auctioned can either be minted by this transaction, or if it already exists in another UTXO on the ledger, the transaction should consume that UTXO as an input.\nWe will not go into the details here of how minting tokens works."}),"\n",(0,i.jsx)(e.h2,{id:"the-first-bid",children:"The first bid"}),"\n",(0,i.jsx)(e.p,{children:"Suppose Bob, the first bidder, wants to bid 100 Ada for Alice's NFT.\nIn order to do this, Bob creates a transaction that has at least two inputs and at least one output."}),"\n",(0,i.jsx)(e.p,{children:"The required inputs are (1) the script UTXO Alice created; (2) Bob's bid of 100 Ada.\nThe 100 Ada can come in one or multiple UTXOs.\nNote that the input UTXOs must have a total value of more than 100 Ada, because in addition to the bid amount, they also need to cover the transaction fee."}),"\n",(0,i.jsxs)(e.p,{children:["The required output is a script UTXO with the same address as the initial UTXO (since the Plutus script itself remains the same), which is known as a ",(0,i.jsx)(e.em,{children:"continuing output"}),".\nThis continuing output UTXO should contain:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["a datum that contains Bob's wallet address and Bob's bid amount (100 Ada).","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Bob's wallet address is used to claim the token (if Bob ends up winning the auction) or receive the refund (if a higher bid is placed later)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"a value: the token being auctioned plus the 100 Ada from Bob's bid."}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"If the input UTXOs contain more Ada than 100 plus the transaction fee, then there should be additional output UTXOs that return the extra Ada.\nAgain, verifying that the input value of a transaction minus the transaction fee equals the output value (unless the transaction is burning tokens) is the responsibility of the ledger, not the Plutus script."}),"\n",(0,i.jsxs)(e.p,{children:["In order for Bob's transaction to be able to spend the initial script UTXO Alice created, Bob's transaction must also contain a redeemer.\nAs shown in the code above, there are two kinds of redeemers in our example: ",(0,i.jsx)(e.code,{children:"NewBid Bid"})," and ",(0,i.jsx)(e.code,{children:"Payout"}),".\nThe redeemer in Bob's transaction is a ",(0,i.jsx)(e.code,{children:"NewBid Bid"})," where the ",(0,i.jsx)(e.code,{children:"Bid"})," contains Bob's wallet address and bid amount."]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"First bid diagram",src:n(1920).A+"",width:"3241",height:"1801"})}),"\n",(0,i.jsx)(e.p,{children:"Once Bob's transaction is submitted, the node validating this transaction will run the Plutus script, which checks a number of conditions like whether the bid happens before the deadline, and whether the bid is high enough.\nIf the checks pass and everything else about the transaction is valid, the transaction will go through and be included in a block.\nAt this point, the initial UTXO created by Alice no longer exists on the ledger, since it has been spent by Bob's transaction."}),"\n",(0,i.jsx)(e.h2,{id:"the-second-bid",children:"The second bid"}),"\n",(0,i.jsx)(e.p,{children:"Next, suppose a second bidder, Charlie, wants to outbid Bob.\nCharlie wants to bid 200 Ada."}),"\n",(0,i.jsx)(e.p,{children:"Charlie will create another transaction.\nThis transaction should have an additional output compared to Bob's transaction: a UTXO that returns Bob's bid of 100 Ada.\nRecall that this is one of the conditions checked by the Plutus script; the transaction is rejected if the refund output is missing."}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Second bid diagram",src:n(914).A+"",width:"3241",height:"1801"})}),"\n",(0,i.jsxs)(e.p,{children:["Charlie's transaction needs to spend the script UTXO produced by Bob's transaction, so it also needs a redeemer.\nThe redeemer is a ",(0,i.jsx)(e.code,{children:"NewBid Bid"})," where ",(0,i.jsx)(e.code,{children:"Bid"})," contains Charlie's wallet address and bid amount.\nCharlie's transaction cannot spend the initial UTXO produced by Alice, since it has already been spent by Bob's transaction."]}),"\n",(0,i.jsx)(e.h2,{id:"closing-the-auction",children:"Closing the auction"}),"\n",(0,i.jsx)(e.p,{children:"Let's assume that there won't be another bid.\nOnce the deadline has passed, the auction can be closed."}),"\n",(0,i.jsx)(e.p,{children:"In order to do that, somebody has to create another transaction.\nThat could be Alice, who wants to collect the bid, or it could be Charlie, who wants to collect the NFT.\nIt can be anybody, but Alice and Charlie have an incentive to create it."}),"\n",(0,i.jsx)(e.p,{children:"This transaction has one required input: the script UTXO produced by Charlie's transaction, and two required outputs: (1) the payment of the auctioned token to Charlie; (2) the payment of 200 Ada to Alice."}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Closing transaction diagram",src:n(5718).A+"",width:"3241",height:"1801"})})]})}function l(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(h,{...t})}):h(t)}},5718:(t,e,n)=>{n.d(e,{A:()=>i});const i=n.p+"assets/images/closing-tx-simple-auction-v3-5213bec3a2100cd0906d59dc29978ad8.png"},1920:(t,e,n)=>{n.d(e,{A:()=>i});const i=n.p+"assets/images/first-bid-simple-auction-v3-947f705bccd8e1f4d6fe1699105a4a4d.png"},914:(t,e,n)=>{n.d(e,{A:()=>i});const i=n.p+"assets/images/second-bid-simple-auction-v3-c35d927ac377099f22d0705b4ed183bf.png"},8453:(t,e,n)=>{n.d(e,{R:()=>o,x:()=>c});var i=n(6540);const s={},a=i.createContext(s);function o(t){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function c(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:o(t.components),i.createElement(a.Provider,{value:e},t.children)}}}]);